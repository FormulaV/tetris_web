<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Tetris (Web) ‚Äî Single File</title>
<style>
  :root{--bg:#0b0f1a;--panel:#0f1724;--accent:#22d3ee;--muted:#94a3b8}
  *{box-sizing:border-box}
  body{margin:0;background:linear-gradient(180deg,#031022 0%, #071428 100%);color:#e6eef8;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,'Helvetica Neue',Arial}
  .wrap{display:flex;gap:20px;align-items:flex-start;justify-content:center;padding:28px}
  .game{background:var(--panel);padding:16px;border-radius:12px;box-shadow:0 6px 30px rgba(2,6,23,.6)}
  canvas{background:#02040a;display:block;border-radius:6px}
  .info{width:260px;padding:12px}
  h1{font-size:18px;margin:6px 0;color:var(--accent)}
  .label{color:var(--muted);font-size:13px}
  .scoreBox{margin-top:12px;background:#061226;padding:10px;border-radius:8px}
  .score{font-size:20px;font-weight:700}
  .controls{margin-top:12px;font-size:13px;color:var(--muted)}
  .btn{display:inline-block;padding:8px 12px;background:#0b1b2a;border-radius:8px;color:var(--accent);cursor:pointer;margin-top:10px;border:0}
  .small{font-size:12px;color:#9fb8cf}
  footer{position:fixed;left:12px;bottom:12px;color:#9fb8cf;font-size:12px}
  .hud{display:flex;gap:10px;align-items:center}
  .nextCanvas{background:#041226;border-radius:6px;padding:6px}
  /* Mobile controls */
  #mobile-controls{position:fixed;bottom:20px;left:50%;transform:translateX(-50%);display:flex;gap:10px;z-index:9999}
  #mobile-controls button{padding:12px 16px;font-size:18px;border-radius:10px;border:0;background:rgba(255,255,255,0.06);color:var(--accent);backdrop-filter: blur(4px)}
  /* Overlays */
  .overlay{position:fixed;inset:0;background:rgba(2,6,23,0.92);display:flex;align-items:center;justify-content:center;z-index:10000}
  .panel{background:var(--panel);padding:20px;border-radius:12px;min-width:280px}
  @media(max-width:720px){.wrap{flex-direction:column;align-items:center}.info{width:95%}}
</style>
</head>
<body>

<!-- MAIN MENU -->
<div id="mainMenu" class="overlay">
  <div class="panel" style="text-align:center">
    <h1 style="color:var(--accent);margin:4px 0 12px 0">TETRIS</h1>
    <div style="display:flex;flex-direction:column;gap:10px;align-items:center">
      <button id="startBtn" class="btn">Start Game</button>
      <button id="openSettingsBtn" class="btn">Settings</button>
    </div>
    <div class="small" style="margin-top:10px">Tap anywhere to enable sound (mobile)</div>
  </div>
</div>

<!-- SETTINGS -->
<div id="settingsMenu" class="overlay" style="display:none;">
  <div class="panel">
    <h2 style="color:var(--accent);margin-top:0">Settings</h2>
    <label class="small">Music Volume</label><br>
    <input id="musicVolume" type="range" min="0" max="1" step="0.01" value="0.20" style="width:100%"><br><br>
    <label class="small">SFX Volume</label><br>
    <input id="sfxVolume" type="range" min="0" max="1" step="0.01" value="0.18" style="width:100%"><br><br>
    <label class="small">Theme</label><br>
    <select id="themeSelect" style="width:100%;padding:8px;margin-top:6px;border-radius:8px;background:#061226;color:var(--accent);border:0">
      <option value="default">Default</option>
      <option value="neon">Neon</option>
      <option value="pastel">Pastel</option>
    </select>
    <div style="display:flex;gap:8px;margin-top:12px;justify-content:flex-end">
      <button id="closeSettingsBtn" class="btn">Back</button>
    </div>
  </div>
</div>

<!-- PAUSE MENU -->
<div id="pauseMenu" class="overlay" style="display:none;">
  <div class="panel">
    <h2 style="color:var(--accent);margin-top:0">Paused</h2>
    <div style="display:flex;flex-direction:column;gap:8px">
      <button id="resumeBtn" class="btn">Resume</button>
      <button id="restartBtn" class="btn">Restart</button>
      <button id="settingsFromPauseBtn" class="btn">Settings</button>
      <button id="exitToMenuBtn" class="btn">Exit to Main Menu</button>
    </div>
  </div>
</div>

<div class="wrap">
  <div class="game">
    <canvas id="board" width="300" height="600"></canvas>
  </div>
  <div class="info">
    <h1>Tetris ‚Äî Web</h1>
    <div class="label">Scoreboard</div>
    <div>High Score: <span id="highscore" class="score">0</span></div>
    <div class="scoreBox">
      <div>Score: <span id="score" class="score">0</span></div>
      <div class="small">Level: <span id="level">1</span> ‚Äî Lines: <span id="lines">0</span></div>
    </div>

    <div style="margin-top:12px">Next:</div>
    <canvas id="next" class="nextCanvas" width="120" height="120"></canvas>

    <div class="controls">
      <p><strong>Controls</strong></p>
      <p>‚Üê ‚Üí : Move &nbsp; &nbsp; ‚Üë : Rotate &nbsp; &nbsp; ‚Üì : Soft drop &nbsp; &nbsp; Space : Hard drop</p>
      <p>P : Pause / Resume</p>
    </div>

    <div style="margin-top:10px">
      <button id="btnRestart2" class="btn">Restart</button>
      <button id="btnToggleSound2" class="btn">Toggle Sound</button>
      <button id="btnOpenPause" class="btn">Menu</button>
    </div>

    <div class="small" style="margin-top:10px">This version uses WebAudio-generated BGM & SFX so no external files are required.</div>
  </div>
</div>
<footer>Save this file and open in your browser ‚Äî to deploy: GitHub Pages / Netlify / Vercel</footer>

<script>
/*
  Clean single-file Tetris with menus.
  This rewrite fixes earlier syntax issues and keeps behavior:
  - Main menu overlay (Start / Settings)
  - Settings overlay (music/sfx volume, theme)
  - Pause menu (Resume / Restart / Settings / Exit)
  - Mobile controls at bottom
*/

const COLS = 10, ROWS = 20, BLOCK = 30;
const boardCanvas = document.getElementById('board');
const ctx = boardCanvas.getContext('2d');
const nextCanvas = document.getElementById('next').getContext('2d');
const scoreEl = document.getElementById('score');
const levelEl = document.getElementById('level');
const linesEl = document.getElementById('lines');

// overlays & buttons
const mainMenu = document.getElementById('mainMenu');
const settingsMenu = document.getElementById('settingsMenu');
const pauseMenu = document.getElementById('pauseMenu');
const startBtn = document.getElementById('startBtn');
const openSettingsBtn = document.getElementById('openSettingsBtn');
const closeSettingsBtn = document.getElementById('closeSettingsBtn');
const settingsFromPauseBtn = document.getElementById('settingsFromPauseBtn');
const resumeBtn = document.getElementById('resumeBtn');
const restartBtn = document.getElementById('restartBtn');
const exitToMenuBtn = document.getElementById('exitToMenuBtn');
const btnRestart2 = document.getElementById('btnRestart2');
const btnToggleSound2 = document.getElementById('btnToggleSound2');
const btnOpenPause = document.getElementById('btnOpenPause');

boardCanvas.width = COLS * BLOCK;
boardCanvas.height = ROWS * BLOCK;

// pieces
const SHAPES = { I:[[1,1,1,1]], O:[[1,1],[1,1]], T:[[0,1,0],[1,1,1]], J:[[1,0,0],[1,1,1]], L:[[0,0,1],[1,1,1]], S:[[0,1,1],[1,1,0]], Z:[[1,1,0],[0,1,1]] };
const COLORS = { I:'#00f0f0', O:'#f0f000', T:'#a000f0', J:'#0000f0', L:'#f08a00', S:'#00f000', Z:'#f00000' };
const BAG = ['I','O','T','J','L','S','Z'];

function makeEmptyBoard(){ const b=[]; for(let r=0;r<ROWS;r++) b.push(new Array(COLS).fill(null)); return b; }
let board = makeEmptyBoard();
let score = 0;
let highScore = parseInt(localStorage.getItem('tetris_highscore') || '0', 10) || 0;
let level = 1, totalLines = 0;
let dropCounter = 0, dropInterval = 1000, lastTime = 0;
let current = null, nextPiece = null;
let isPaused = true, isRunning = false;

// audio
let audioCtx = null, musicGain = null, sfxGain = null, soundOn = true;
function ensureAudio(){ if(!audioCtx){ audioCtx = new (window.AudioContext || window.webkitAudioContext)(); musicGain = audioCtx.createGain(); sfxGain = audioCtx.createGain(); musicGain.gain.value = 0.2; sfxGain.gain.value = 0.18; musicGain.connect(audioCtx.destination); sfxGain.connect(audioCtx.destination); startBGM(); } }
function playSimple(type){ if(!soundOn || !audioCtx) return; const o = audioCtx.createOscillator(); const g = audioCtx.createGain(); if(type === 'click'){ o.type = 'sine'; o.frequency.setValueAtTime(600, audioCtx.currentTime); g.gain.setValueAtTime(0.12, audioCtx.currentTime); o.connect(g); g.connect(sfxGain); o.start(); o.stop(audioCtx.currentTime + 0.06); }
 if(type === 'clear'){ o.type = 'sawtooth'; o.frequency.setValueAtTime(250, audioCtx.currentTime); g.gain.setValueAtTime(0.18, audioCtx.currentTime); o.connect(g); g.connect(sfxGain); o.start(); o.frequency.exponentialRampToValueAtTime(800, audioCtx.currentTime + 0.18); g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + 0.35); o.stop(audioCtx.currentTime + 0.4); }
 if(type === 'drop'){ o.type = 'triangle'; o.frequency.setValueAtTime(120, audioCtx.currentTime); g.gain.setValueAtTime(0.08, audioCtx.currentTime); o.connect(g); g.connect(sfxGain); o.start(); o.stop(audioCtx.currentTime + 0.05); } }
let bgmTimer = null; function startBGM(){ if(!audioCtx || !soundOn) return; stopBGM(); const notes = [220,330,440,330]; const t0 = audioCtx.currentTime; notes.forEach((n,i)=>{ const o = audioCtx.createOscillator(); const g = audioCtx.createGain(); o.type = 'square'; o.frequency.setValueAtTime(n, t0 + i*0.15); g.gain.setValueAtTime(0.03, t0 + i*0.15); o.connect(g); g.connect(musicGain); o.start(t0 + i*0.15); o.stop(t0 + i*0.15 + 0.4); }); bgmTimer = setTimeout(()=>{ if(soundOn) startBGM(); }, 600); }
function stopBGM(){ if(bgmTimer){ clearTimeout(bgmTimer); bgmTimer = null; } }

// game functions
function randBag(){ const bag = BAG.slice(); for(let i = bag.length-1; i>0; i--){ const j = Math.floor(Math.random()*(i+1)); [bag[i], bag[j]] = [bag[j], bag[i]]; } return bag; }
let bag = randBag();
function nextFromBag(){ if(bag.length === 0) bag = randBag(); return bag.pop(); }
function createPiece(key){ return { key, shape: SHAPES[key].map(r=>r.slice()), x: Math.floor(COLS/2 - Math.ceil(SHAPES[key][0].length/2)), y: 0, color: COLORS[key] }; }
function rotateShape(shape){ const H = shape.length, W = shape[0].length; const out = Array.from({length:W}, ()=>Array(H).fill(0)); for(let r=0;r<H;r++) for(let c=0;c<W;c++) out[c][H-1-r] = shape[r][c]; return out; }
function collide(board, shape, x, y){ for(let r=0;r<shape.length;r++) for(let c=0;c<shape[r].length;c++) if(shape[r][c]){ const bx = x+c, by = y+r; if(bx<0||bx>=COLS||by>=ROWS) return true; if(by>=0 && board[by][bx]) return true; } return false; }
function placePiece(){ current.shape.forEach((row,r)=>row.forEach((v,c)=>{ if(v){ const bx = current.x + c, by = current.y + r; if(by>=0) board[by][bx] = current.color; } })); let linesCleared = 0; for(let r = ROWS-1; r>=0; r--){ if(board[r].every(cell=>cell)){ board.splice(r,1); board.unshift(new Array(COLS).fill(null)); linesCleared++; r++; } } if(linesCleared>0){ totalLines += linesCleared; score += scoreFor(linesCleared); playSimple('clear'); } level = Math.floor(totalLines/10) + 1; dropInterval = Math.max(100, 1000 - (level-1)*80); }
function scoreFor(lines){ const map = {1:100,2:300,3:500,4:800}; return map[lines] || 0; }
function spawn(){ if(!nextPiece) nextPiece = createPiece(nextFromBag()); current = nextPiece; nextPiece = createPiece(nextFromBag()); if(collide(board, current.shape, current.x, current.y)){ gameOver(); } }
function hardDrop(){ while(!collide(board, current.shape, current.x, current.y+1)){ current.y++; } placePiece(); playSimple('drop'); spawn(); }
function gameOver(){ if(score > highScore){ highScore = score; try{ localStorage.setItem('tetris_highscore', String(highScore)); }catch(e){} } isRunning = false; isPaused = true; alert('Game Over\nScore: ' + score + '\nHigh Score: ' + highScore); showMainMenu(); }
function move(dx){ if(!collide(board, current.shape, current.x + dx, current.y)){ current.x += dx; playSimple('click'); } }
function softDrop(){ if(!collide(board, current.shape, current.x, current.y+1)){ current.y++; score++; } else { placePiece(); spawn(); } }
function rotateCurrent(){ const r = rotateShape(current.shape); if(!collide(board, r, current.x, current.y)){ current.shape = r; playSimple('click'); return; } if(!collide(board, r, current.x-1, current.y)){ current.x--; current.shape = r; playSimple('click'); return; } if(!collide(board, r, current.x+1, current.y)){ current.x++; current.shape = r; playSimple('click'); return; } }

// wrappers for mobile buttons
function moveLeft(){ move(-1); }
function moveRight(){ move(1); }
function rotatePiece(){ rotateCurrent(); }

function draw(){ ctx.clearRect(0,0,boardCanvas.width,boardCanvas.height); for(let r=0;r<ROWS;r++) for(let c=0;c<COLS;c++){ ctx.fillStyle = board[r][c] || '#071428'; ctx.fillRect(c*BLOCK, r*BLOCK, BLOCK-1, BLOCK-1); } if(current){ const ghostY = computeGhostY(); drawShapeAt(current.shape, current.x, ghostY, 'rgba(255,255,255,0.08)'); drawShapeAt(current.shape, current.x, current.y, current.color); } }
function drawShapeAt(shape, x, y, color){ for(let r=0;r<shape.length;r++) for(let c=0;c<shape[r].length;c++) if(shape[r][c]){ ctx.fillStyle = color; ctx.fillRect((x+c)*BLOCK, (y+r)*BLOCK, BLOCK-1, BLOCK-1); } }
function computeGhostY(){ if(!current) return 0; let y = current.y; while(!collide(board, current.shape, current.x, y+1)) y++; return y; }
function drawNext(){ nextCanvas.clearRect(0,0,nextCanvas.canvas.width,nextCanvas.canvas.height); if(!nextPiece) return; const s = nextPiece.shape; const size = BLOCK; const offX = (nextCanvas.canvas.width - s[0].length*size)/2; const offY = (nextCanvas.canvas.height - s.length*size)/2; for(let r=0;r<s.length;r++) for(let c=0;c<s[r].length;c++) if(s[r][c]){ nextCanvas.fillStyle = nextPiece.color; nextCanvas.fillRect(offX + c*size, offY + r*size, size-2, size-2); } }

function update(time=0){ if(!lastTime) lastTime = time; const delta = time - lastTime; lastTime = time; if(!isPaused && isRunning && current){ dropCounter += delta; if(dropCounter > dropInterval){ dropCounter = 0; if(!collide(board, current.shape, current.x, current.y+1)){ current.y++; } else { placePiece(); spawn(); } } } draw(); drawNext(); scoreEl.textContent = score; levelEl.textContent = level; linesEl.textContent = totalLines; updateHighScoreUI(); if(isRunning) requestAnimationFrame(update); }

// input
window.addEventListener('keydown', function(e){ if(e.repeat) return; if(e.key === 'ArrowLeft') move(-1); else if(e.key === 'ArrowRight') move(1); else if(e.key === 'ArrowUp') rotateCurrent(); else if(e.key === 'ArrowDown') softDrop(); else if(e.code === 'Space') hardDrop(); else if(e.key.toLowerCase() === 'p') togglePause(); });

// touch simple swipe/tap
let touchStartX = null; boardCanvas.addEventListener('touchstart', function(e){ const t = e.touches[0]; touchStartX = t.clientX; }, {passive:true}); boardCanvas.addEventListener('touchend', function(e){ const t = e.changedTouches[0]; const dx = t.clientX - touchStartX; if(Math.abs(dx) > 30) move(dx>0?1:-1); else rotateCurrent(); }, {passive:true});

// UI wiring
startBtn.addEventListener('click', function(){ startGame(); });
openSettingsBtn.addEventListener('click', function(){ showSettings(false); });
closeSettingsBtn.addEventListener('click', function(){ closeSettings(); });
settingsFromPauseBtn.addEventListener('click', function(){ showSettings(true); });
resumeBtn.addEventListener('click', function(){ resumeGame(); });
restartBtn.addEventListener('click', function(){ restartGame(); });
exitToMenuBtn.addEventListener('click', function(){ exitToMainMenu(); });
btnRestart2.addEventListener('click', function(){ restartGame(); });
btnToggleSound2.addEventListener('click', function(){ soundOn = !soundOn; if(!soundOn) stopBGM(); else { ensureAudio(); startBGM(); } btnToggleSound2.textContent = soundOn? 'Toggle Sound' : 'Sound Off'; });
btnOpenPause.addEventListener('click', function(){ togglePause(); });

// settings elements
const musicVolumeInput = document.getElementById('musicVolume');
const sfxVolumeInput = document.getElementById('sfxVolume');
const themeSelect = document.getElementById('themeSelect');
musicVolumeInput.addEventListener('input', function(e){ if(musicGain) musicGain.gain.value = parseFloat(e.target.value); });
sfxVolumeInput.addEventListener('input', function(e){ if(sfxGain) sfxGain.gain.value = parseFloat(e.target.value); });
themeSelect.addEventListener('change', function(e){ applyTheme(e.target.value); });

function showMainMenu(){ mainMenu.style.display='flex'; settingsMenu.style.display='none'; pauseMenu.style.display='none'; isRunning=false; isPaused=true; }
function startGame(){ mainMenu.style.display='none'; settingsMenu.style.display='none'; pauseMenu.style.display='none'; resetGame(); isPaused=false; isRunning=true; ensureAudio(); lastTime=0; requestAnimationFrame(update); }
function showSettings(fromPause){ settingsMenu.style.display='flex'; if(fromPause){ pauseMenu.style.display='none'; } else { mainMenu.style.display='none'; } }
function closeSettings(){ settingsMenu.style.display='none'; if(isRunning && isPaused) pauseMenu.style.display='flex'; else if(!isRunning) mainMenu.style.display='flex'; }
function togglePause(){ if(!isRunning) return; if(isPaused) resumeGame(); else pauseGame(); }
function pauseGame(){ isPaused=true; pauseMenu.style.display='flex'; }
function resumeGame(){ isPaused=false; pauseMenu.style.display='none'; }
function restartGame(){ resetGame(); pauseMenu.style.display='none'; }
function exitToMainMenu(){ showMainMenu(); }

function resetGame(){ board = makeEmptyBoard(); score=0; level=1; totalLines=0; bag=randBag(); nextPiece=createPiece(nextFromBag()); spawn(); dropCounter=0; updateHighScoreUI(); }

// theme helper
function applyTheme(name){ if(name==='neon') document.documentElement.style.setProperty('--accent','#39ff14'); else if(name==='pastel') document.documentElement.style.setProperty('--accent','#a78bfa'); else document.documentElement.style.setProperty('--accent','#22d3ee'); }

function updateHighScoreUI(){ const el = document.getElementById('highscore'); if(el) el.textContent = highScore; }

// start with main menu visible
showMainMenu();
// allow audio on first click
window.addEventListener('click', function(){ if(!audioCtx && soundOn) ensureAudio(); }, {once:true});

</script>

<!-- Mobile controls -->
<div id="mobile-controls">
  <button onclick="moveLeft()">‚¨ÖÔ∏è</button>
  <button onclick="rotatePiece()">üîÑ</button>
  <button onclick="moveRight()">‚û°Ô∏è</button>
  <button onclick="softDrop()">‚¨áÔ∏è</button>
  <button onclick="hardDrop()">‚è¨</button>
</div>

</body>
</html>
